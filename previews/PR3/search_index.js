var documenterSearchIndex = {"docs":
[{"location":"multithreading/#Multi-threading","page":"Multi threading","title":"Multi threading","text":"","category":"section"},{"location":"multithreading/","page":"Multi threading","title":"Multi threading","text":"srun --qos=np --nodes=1 --ntasks-per-node=1 --cpus-per-task=256 --pty bash -i","category":"page"},{"location":"multithreading/","page":"Multi threading","title":"Multi threading","text":"Start julia with julia --threads=auto or julia --threads=N  ","category":"page"},{"location":"multithreading/","page":"Multi threading","title":"Multi threading","text":"julia> function readall(files) \n           dfs=DataFrame[]\n           Threads.@threads for file in files\n              push!(dfs, read_v(file,select=[:ID,:TT,:DD,:FF]))\n           end; \n           return dfs \n       end","category":"page"},{"location":"multithreading/","page":"Multi threading","title":"Multi threading","text":"julia> files = glob(\"vfld*\", \"/scratch/fai/vfld/SPP_DP\")\njulia> @benchmark dfs = readall(files)","category":"page"},{"location":"multithreading/","page":"Multi threading","title":"Multi threading","text":"BenchmarkTools.Trial: 5 samples with 1 evaluation.\n Range (min … max):  980.453 ms …   1.168 s  ┊ GC (min … max): 0.00% … 0.00%\n Time  (median):        1.110 s              ┊ GC (median):    0.00%\n Time  (mean ± σ):      1.092 s ± 74.973 ms  ┊ GC (mean ± σ):  0.00% ± 0.00%\n\n  █                       █                █          █      █  \n  █▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁█▁▁▁▁▁▁▁▁▁▁█▁▁▁▁▁▁█ ▁\n  980 ms          Histogram: frequency by time          1.17 s <\n\n Memory estimate: 5.14 GiB, allocs estimate: 39591794.","category":"page"},{"location":"sqlite/#Creating-Sqlite-databases","page":"Creating Sqlite databases","title":"Creating Sqlite databases","text":"","category":"section"},{"location":"sqlite/","page":"Creating Sqlite databases","title":"Creating Sqlite databases","text":"using Sqlite\ndb = SQLite.DB()\nread_v(file) |> SQLite.load!(db, \"synop\")","category":"page"},{"location":"read/#Reading","page":"Reading","title":"Reading","text":"","category":"section"},{"location":"read/#Single-file","page":"Reading","title":"Single file","text":"","category":"section"},{"location":"read/","page":"Reading","title":"Reading","text":"To read a single vobs or  vfld file ","category":"page"},{"location":"read/","page":"Reading","title":"Reading","text":"myshow(df) = show(df,truncate=10,show_row_number=false, display_size = (21, 90),maximum_columns_width = 15) ","category":"page"},{"location":"read/","page":"Reading","title":"Reading","text":"using VfldFiles, Glob\n\nvfldfile = \"assets/vfldMEPS_prodmbr000201902170027\"\n\n@show basename(vfldfile)\n\ndf = read_v(vfldfile, select=[:ID,:TT])\n\nmyshow(df) #hide","category":"page"},{"location":"read/#Multiple-files-reduce-vcat","page":"Reading","title":"Multiple files reduce vcat","text":"","category":"section"},{"location":"read/","page":"Reading","title":"Reading","text":"Or use reduce  and vcat to vertically concatenate dataframes.  Note in  read_v. the . will broadcast the read_v function over the vfldfiles array","category":"page"},{"location":"read/","page":"Reading","title":"Reading","text":"df = reduce(vcat, read_v.([vfldfile vfldfile],select=[:ID,:TT]))\n\nmyshow(df) #hide","category":"page"},{"location":"read/","page":"Reading","title":"Reading","text":"note: Note\nAnalysis dataframe has leadtime==missing forecast 00  leadtime==Hour(0) vfldSPP_DPmbr00020221101002083×7 DataFrame\n  Row │ validtime            leadtime  basetime             mbr     exp     ID       TT      \n      │ DateTime             Missing   DateTime             String  String  Int64    Float64 \n──────┼──────────────────────────────────────────────────────────────────────────────────────\n    1 │ 2022-11-01T00:00:00   missing  2022-11-01T00:00:00  mbr000  SPP_DP     1001  277.038\n    2 │ 2022-11-01T00:00:00   missing  2022-11-01T00:00:00  mbr000  SPP_DP     1010  281.141\n    3 │ 2022-11-01T00:00:00   missing  2022-11-01T00:00:00  mbr000  SPP_DP     1014  276.542\n    4 │ 2022-11-01T00:00:00   missing  2022-11-01T00:00:00  mbr000  SPP_DP     1015  279.33vfldSPP_DPmbr0002022110100002083×7 DataFrame\n  Row │ validtime            leadtime  basetime             mbr     exp     ID       TT      \n      │ DateTime             Hour      DateTime             String  String  Int64    Float64 \n──────┼──────────────────────────────────────────────────────────────────────────────────────\n    1 │ 2022-11-01T00:00:00  0 hours   2022-11-01T00:00:00  mbr000  SPP_DP     1001  276.363\n    2 │ 2022-11-01T00:00:00  0 hours   2022-11-01T00:00:00  mbr000  SPP_DP     1010  281.505\n    3 │ 2022-11-01T00:00:00  0 hours   2022-11-01T00:00:00  mbr000  SPP_DP     1014  276.813\n    4 │ 2022-11-01T00:00:00  0 hours   2022-11-01T00:00:00  mbr000  SPP_DP     1015  280.019","category":"page"},{"location":"tarballs/#Reading-compressed-tar-balls-from-archive/extract","page":"Reading compressed tar balls from archive/extract","title":"Reading compressed tar balls from archive/extract","text":"","category":"section"},{"location":"tarballs/","page":"Reading compressed tar balls from archive/extract","title":"Reading compressed tar balls from archive/extract","text":"using Tar, CodecZlib\ntar_gz =  open(\"/scratch/path/to/exp/archive/extract/vobs20190818.tar.gz\")\ntar    = GzipDecompressor(tar_gz)\ndir    = Tar.extract(tar)\n\n","category":"page"},{"location":"tarballs/","page":"Reading compressed tar balls from archive/extract","title":"Reading compressed tar balls from archive/extract","text":"Then read dir ","category":"page"},{"location":"innerjoin/#Inner-joins","page":"Inner joins","title":"Inner joins","text":"","category":"section"},{"location":"innerjoin/","page":"Inner joins","title":"Inner joins","text":"\nmyshow(df) = show(df,truncate=10,show_row_number=false, display_size = (21, 90),maximum_columns_width = 15) \n\nusing VfldFiles, Glob, DataFrames\n\nvobsfiles = \"assets/vfldMEPS_prodmbr000201902170027\"\nvfldfiles = \"assets/vobs2019022015\"\nnothing #hide","category":"page"},{"location":"innerjoin/","page":"Inner joins","title":"Inner joins","text":"vobs_df =  read_v(vobsfiles,select=[:ID, :TT])\nvfld_df =  read_v(vfldfiles,select=[:ID, :TT]) \nnothing #hide","category":"page"},{"location":"innerjoin/","page":"Inner joins","title":"Inner joins","text":"df = innerjoin(vfld_df,vobs_df,on=[:ID,:validtime],makeunique=true)\nmyshow(df)  #hide","category":"page"},{"location":"plotting/#Plots","page":"Plots","title":"Plots","text":"","category":"section"},{"location":"plotting/","page":"Plots","title":"Plots","text":"using VfldFiles, Glob, Plots, DataFrames\n\nvobsfiles = glob(\"vobs*\",obs)\nvfldfiles = glob(\"vfld*\",MEPS_prod)\n\n\nobs_df = reduce(vcat, read_v.(vobsfiles,select=[:ID,:TT]))\nvfld_df = reduce(vcat, read_v.(vfldfiles,select=[:ID,:TT]))\n\nvobsfld = innerjoin(vfld_df,obs_df,on=[:ID,:validtime],makeunique=true)\n\ngdf=groupby(vobsfld,[:leadtime])\n\nfunction plotind(gdf,i)\n    p = scatter(gdf[i][:,:TT_1],gdf[i][:,:TT],legend=false,markersize=2);\n    title!(p,string((keys(gdf)[i]).leadtime))\n    plot!(p,[250, 300],[250, 300],linewidth=3)\n    xlabel!(p,\"obs\")\n    ylabel!(p,\"fc\")\n\n    return p \nend \n\n\nplot(plotind(gdf,1), plotind(gdf,3), plotind(gdf,5), plotind(gdf,11), layout=grid(2,2))","category":"page"},{"location":"plotting/","page":"Plots","title":"Plots","text":"(Image: )","category":"page"},{"location":"distributed/#Distributed","page":"Distributed","title":"Distributed","text":"","category":"section"},{"location":"distributed/","page":"Distributed","title":"Distributed","text":"E.g. on Atos ","category":"page"},{"location":"distributed/","page":"Distributed","title":"Distributed","text":"using Distributed, ClusterManagers, Glob\naddprocs_slurm(10)  # Will use the fractional queue by default   \n \n@everywhere using VfldFiles \n\nfiles = glob(\"vfld*\", \"/scratch/fai/vfld/SPP_DP\")\n\n@distributed vcat for file in files\n    read_v(file,select=[:TT,:DD,:FF])\nend","category":"page"},{"location":"#VfldFiles","page":"VfldFiles","title":"VfldFiles","text":"","category":"section"},{"location":"","page":"VfldFiles","title":"VfldFiles","text":"This packages exports a single function read_v which reads a vobs or vfld file and returns a dataframe  ","category":"page"},{"location":"#Installation","page":"VfldFiles","title":"Installation","text":"","category":"section"},{"location":"","page":"VfldFiles","title":"VfldFiles","text":"If you have added the Harmonie Registry","category":"page"},{"location":"","page":"VfldFiles","title":"VfldFiles","text":"pkg> add VfldFiles ","category":"page"},{"location":"vcat/#Concatenation","page":"Concatenation","title":"Concatenation","text":"","category":"section"},{"location":"vcat/","page":"Concatenation","title":"Concatenation","text":"myshow(df) = show(df,truncate=10,show_row_number=false, display_size = (21, 90),maximum_columns_width = 15) \nusing VfldFiles, Glob\n\nvfldfile = \"assets/vfldMEPS_prodmbr000201902170027\" \nvobsfile = \"assets/vobs2019022015\"\n","category":"page"},{"location":"vcat/","page":"Concatenation","title":"Concatenation","text":"To vertically concatenated dataframes use ","category":"page"},{"location":"vcat/","page":"Concatenation","title":"Concatenation","text":"vfld_df = read_v(vfldfile, select=[:ID,:TT])\nvobs_df = read_v(vobsfile, select=[:ID,:TT])\n\ndf = vcat(vfld_df,vobs_df,cols=:union)\nmyshow(df) #hide","category":"page"},{"location":"vcat/","page":"Concatenation","title":"Concatenation","text":"note: Note\nvobs dataframes have missing values for leadtime and basetime","category":"page"}]
}
